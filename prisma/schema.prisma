generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  name      String?
  role      Role     @default(STUDENT)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  posts     Post[]
  gallery   Gallery[]
  pages     Page[]
  majors    Major[]
}

enum Role {
  ADMIN
  TEACHER
  STUDENT
  ALUMNI
}

// Global Configuration (Singleton pattern ideally)
model SchoolConfig {
  id          String   @id @default("config")
  name        String   @default("SMK Enscho")
  phone       String?
  email       String?
  address     String?  @db.Text
  facebook    String? // Deprecated
  instagram   String? // Deprecated
  youtube     String? // Deprecated
  tiktok      String? // Deprecated
  socialMedia Json?   // New flexible configuration
  
  logoUrl     String? // For site logo
  slogan      String? // For website title (Name - Slogan)
  footerDescription String? @db.Text // Description shown in footer
  primaryColor String? @default("#2563eb") // Default to blue-600
  openingHours String? @db.Text // e.g. "Senin - Jumat: 07:00 - 16:00\nSabtu: 07:00 - 12:00"
  
  // School Profile Content
  history     String? @db.Text // Sejarah Singkat
  vision      String? @db.Text // Visi Kami

  updatedAt   DateTime @updatedAt
}

// For static pages like 'visi-misi', 'sejarah', 'sambutan'
model Page {
  id        String   @id @default(cuid())
  title     String
  slug      String   @unique
  content   String   @db.LongText
  authorId  String?
  author    User?    @relation(fields: [authorId], references: [id])
  updatedAt DateTime @updatedAt
}

model HeroSlide {
  id        String   @id @default(cuid())
  title     String?
  subtitle  String?
  imageUrl  String
  link      String?
  order     Int      @default(0)
  active    Boolean  @default(true)
}

model Major {
  id          String   @id @default(cuid())
  name        String
  slug        String   @unique
  description String   @db.Text
  content     String?  @db.LongText
  imageUrl    String?
  
  // New detailed fields
  careerProspects String? @db.Text  // Stored as newline separated items
  competencies    String? @db.Text  // Stored as newline separated items

  authorId  String?
  author    User?    @relation(fields: [authorId], references: [id])

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  registrations1 StudentRegistration[] @relation("Jurusan1")
  registrations2 StudentRegistration[] @relation("Jurusan2")
}

// For Guru & Staf
model Employee {
  id        String   @id @default(cuid())
  name      String
  position  String?
  category  String   // 'GURU', 'STAF', 'KEPSEK'
  imageUrl  String?
  order     Int      @default(0)
}

model Post {
  id        String   @id @default(cuid())
  title     String
  slug      String   @unique
  content   String   @db.LongText
  excerpt   String?  @db.Text
  category  String   // 'news', 'article', 'agenda', 'loker'
  imageUrl  String?
  published Boolean  @default(false)
  authorId  String?
  author    User?    @relation(fields: [authorId], references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Partner {
  id        String   @id @default(cuid())
  name      String
  logoUrl   String?
  website   String?
  createdAt DateTime @default(now())
}

model Gallery {
  id        String   @id @default(cuid())
  title     String?
  imageUrl  String
  category  String?
  authorId  String?
  author    User?    @relation(fields: [authorId], references: [id])
  createdAt DateTime @default(now())
}

model Document {
  id        String   @id @default(cuid())
  title     String
  fileUrl   String
  size      String?
  category  String   @default("akademik")
  createdAt DateTime @default(now())
}

model AcademicFeature {
  id          String   @id @default(cuid())
  title       String
  description String   @db.Text
  icon        String   // Storing icon name e.g., "Calendar", "Book"
  actionText  String
  href        String
  order       Int      @default(0)
  createdAt   DateTime @default(now())
}

model SchoolFeature {
  id          String   @id @default(cuid())
  title       String
  description String   @db.Text
  icon        String
  color       String   @default("blue")
  order       Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model StudentRegistration {
  id              String   @id @default(cuid())
  registrationNo  String   @unique // Auto-generated e.g., PPDB-2024-001
  
  // 1. Informasi Pendaftaran
  jalurPendaftaran String // e.g. "Reguler", "Prestasi"
  
  // Relations for Majors
  pilihanJurusan1Id String
  pilihanJurusan1   Major @relation("Jurusan1", fields: [pilihanJurusan1Id], references: [id])
  
  pilihanJurusan2Id String?
  pilihanJurusan2   Major? @relation("Jurusan2", fields: [pilihanJurusan2Id], references: [id])

  asalSekolah     String
  alamatSekolah   String? @db.Text
  
  // 2. Data Pribadi
  nisn            String?
  namaLengkap     String
  jenisKelamin    String   // L/P
  nik             String
  noKk            String?
  tempatLahir     String
  tanggalLahir    DateTime
  agama           String
  
  // Alamat Lengkap
  alamatJalan     String? @db.Text
  rt              String?
  rw              String?
  dusun           String?
  desaKelurahan   String?
  kecamatan       String?
  kabupatenKota   String?
  provinsi        String?
  kodePos         String?
  
  noHp            String
  email           String?
  
  // KIP/KIS (Optional)
  noKip           String?
  noKis           String?
  
  // 3. Data Orang Tua / Wali
  namaAyah        String
  nikAyah         String?
  tahunLahirAyah  String?
  pendidikanAyah  String?
  pekerjaanAyah   String?
  penghasilanAyah String?
  noHpAyah        String?
  
  namaIbu         String
  nikIbu          String?
  tahunLahirIbu   String?
  pendidikanIbu   String?
  pekerjaanIbu    String?
  penghasilanIbu  String?
  noHpIbu         String?
  
  namaWali        String?
  pekerjaanWali   String?
  penghasilanWali String?
  noHpWali        String?
  
  // 4. Data Periodik / Fisik
  tinggiBadan     Float? // cm
  beratBadan      Float? // kg
  jumlahSaudara   Int?
  
  // Distance & Transport
  jarakKeSekolah  String? // "Kurang dari 1 km" | "Lebih dari 1 km"
  jarakKm         Float?  // Input: km
  waktuTempuh     String? // Input: "JJ:MM"
  transportasi    String? // Input: "Jalan Kaki", "Motor", etc.
  
  // Documents (URLs)
  fotoUrl         String? // Pas Foto with Preview in UI
  
  // System
  status          RegistrationStatus @default(PENDING)
  notes           String? @db.Text // Admin notes
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

enum RegistrationStatus {
  PENDING
  VERIFIED
  ACCEPTED
  REJECTED
}
